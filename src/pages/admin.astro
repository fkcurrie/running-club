---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Admin Dashboard">
  <h1>Admin Dashboard</h1>
  <p>Select a category to manage.</p>

  <div class="grid">
    <a href="/admin/members" role="button">Manage Members</a>
    <a href="/admin/announcements" role="button">Manage Announcements</a>
    <a href="/admin/events" role="button">Manage Events</a>
  </div>
</Layout>

<script>
  import { createClient } from '@supabase/supabase-js';

  const body = document.querySelector('body');
  const supabaseUrl = body.dataset.supabaseUrl;
  const supabaseAnonKey = body.dataset.supabaseAnonKey;

  if (!supabaseUrl || !supabaseAnonKey) {
    console.error("Supabase credentials not found in the DOM.");
  } else {
    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    async function checkAdminStatus() {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        window.location.href = '/login';
        return;
      }
      const { data: profile, error } = await supabase
        .from('profiles')
        .select('is_admin')
        .eq('id', user.id)
        .single();
      if (error || !profile || !profile.is_admin) {
        console.error('Admin access denied.');
        window.location.href = '/';
      }
    }
    checkAdminStatus();

    document.getElementById('logout-button').addEventListener('click', async () => {
      await supabase.auth.signOut();
      window.location.href = '/';
    });
  }
</script>
